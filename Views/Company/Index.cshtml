
@{
    ViewBag.Title = "List Company";
}

<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
    <div class="card">
        <div class="header">
            <h2>@ViewBag.Title</h2>
            <br />
            <button type="button" class="btn btn-primary waves-effect m-r-20" data-toggle="modal" data-target="#addModal">Add Company</button>
        </div>
        <div class="body">
            <div class="table-responsive">
                <table id="dataTables1" class="table table-bordered table-striped table-hover js-basic-example dataTable"></table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="defaultModalLabel">Add Company</h4>
            </div>
            <div class="modal-body">
                <form>
                    <label for="CompanyName">Company Name</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" id="CompanyName" class="form-control" placeholder="Enter Company name here">
                        </div>
                    </div>

                    <label for="CompanyAddress">Address</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" id="CompanyAddress" class="form-control" placeholder="Enter Address here">
                        </div>
                    </div>

                    <label for="CompanyCity">City</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" id="CompanyCity" class="form-control" placeholder="Enter Company City here">
                        </div>
                    </div>

                    <label for="CompanyPoscode">Poscode</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" id="CompanyPoscode" class="form-control" placeholder="Enter Company Poscode here">
                        </div>
                    </div>

                    <label for="CompanyEmail">Email</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" id="CompanyEmail" class="form-control" placeholder="Enter Company Email here">
                        </div>
                    </div>

                    <label for="CompanyPhone">Phone</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" id="CompanyPhone" class="form-control" placeholder="Enter Company Phone here">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="submit" id="btnSubmit" class="btn btn-success waves-effect">SAVE</button>
                <button type="button" class="btn btn-link waves-effect" data-dismiss="modal">CLOSE</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form>
                <div class="modal-header">
                    <h4 class="modal-title" id="defaultModalLabel">Edit User</h4>
                </div>
                <div class="modal-body">
                    <label for="updateCompanyNo">Company No</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" id="updateCompanyNo" class="form-control" placeholder="Enter Company no here" readonly>
                        </div>
                    </div>

                    <label for="updateCompanyName">Company Name</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" id="updateCompanyName" class="form-control" placeholder="Enter Company name here">
                        </div>
                    </div>

                    <label for="updateCompanyAddress">Address</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" id="updateCompanyAddress" class="form-control" placeholder="Enter Address here">
                        </div>
                    </div>

                    <label for="updateCompanyCity">City</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" id="updateCompanyCity" class="form-control" placeholder="Enter Company City here">
                        </div>
                    </div>

                    <label for="updateCompanyPoscode">Poscode</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" id="updateCompanyPoscode" class="form-control" placeholder="Enter Company Poscode here">
                        </div>
                    </div>

                    <label for="updateCompanyEmail">Email</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" id="updateCompanyEmail" class="form-control" placeholder="Enter Company Email here">
                        </div>
                    </div>

                    <label for="updateCompanyPhone">Phone</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" id="updateCompanyPhone" class="form-control" placeholder="Enter Company Phone here">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" id="btnUpdateCompany" class="btn btn-success waves-effect">SAVE</button>
                    <button type="button" class="btn btn-link waves-effect" data-dismiss="modal">CLOSE</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form>
                <div class="modal-body">
                    <p>Are you sure want to delete this Company <label id="lblCompanyNo"></label>-<label id="lblCompanyName"></label></p>
                </div>
                <div class="modal-footer">
                    <button type="submit" id="btnDeleteCompany" class="btn btn-success waves-effect">OK</button>
                    <button type="button" class="btn btn-danger waves-effect" data-dismiss="modal">CANCEL</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section scripts
{
    <script src="~/Assets/plugins/jquery-datatable/jquery.dataTables.js"></script>
    <script src="~/Assets/plugins/jquery-datatable/skin/bootstrap/js/dataTables.bootstrap.js"></script>
    <script src="~/Assets/plugins/jquery-datatable/extensions/export/dataTables.buttons.min.js"></script>
    <script src="~/Assets/plugins/jquery-datatable/extensions/export/buttons.flash.min.js"></script>
    <script src="~/Assets/plugins/jquery-datatable/extensions/export/jszip.min.js"></script>
    <script src="~/Assets/plugins/jquery-datatable/extensions/export/pdfmake.min.js"></script>
    <script src="~/Assets/plugins/jquery-datatable/extensions/export/vfs_fonts.js"></script>
    <script src="~/Assets/plugins/jquery-datatable/extensions/export/buttons.html5.min.js"></script>
    <script src="~/Assets/plugins/jquery-datatable/extensions/export/buttons.print.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $(function () {
                $("form").submit(function () { return false; });
            });

            $('#btnSubmit').click(function () {
                $.ajax({
                    url: "/Company/saveCompany",
                    type: "POST",
                    dataType: 'json',
                    data: {
                        CompanyName: $('#CompanyName').val(),
                        CompanyAddress: $('#CompanyAddress').val(),
                        CompanyCity: $('#CompanyCity').val(),
                        CompanyPoscode: $('#CompanyPoscode').val(),
                        CompanyEmail: $('#CompanyEmail').val(),
                        CompanyPhone: $('#CompanyPhone').val(),
                    },
                    success: function (message) {
                        if (message.success) {
                            $('#addModal').modal('toggle');
                            Table.ajax.reload();
                        } else {
                            alert(message.Message);
                        }
                    }
                })
            });

            var Table = $('#dataTables1').DataTable({
                serverSide: true,
                processing: true,
                paging: true,
                searching: false,
                ajax: {
                    url: "/Company/getDataCompanys",
                    type: "POST",
                    dataSrc: 'data',
                    "error": function (data) {
                        alert(data.message);
                    },
                },
                columns: [
                    { data: "companyName", title: 'Company Name' },
                    { data: "address", title: 'Address' },
                    { data: "city", title: 'City' },
                    { data: "email", title: 'Email' },
                    { data: "phone", title: 'Phone' },
                    {
                        title: '',
                        render: function (data, type, row) {
                            return "<div class='btn-toolbar'><div class='btn-group mr-4' role='group'><button type='button' id='btnDelete' class='btn btn-danger btn-xs' data-id='" + row.companyId + "' data-name='" + row.companyName + "' >Delete</button></div><div class='btn-group mr-4' role='group'> <button type='button' id='btnUpdate' class='btn btn-warning btn-xs' data-id='" + row.companyId + "' data-name='" + row.companyName + "' data-address='" + row.address + "' data-city='" + row.city + "' data-poscode='" + row.poscode + "' data-email='" + row.email + "' data-phone='"+ row.phone +"'>Update</button></div></div>";
                        }
                    }
                ]
            });

            $(document).on('click', '#btnDelete', function () {
                var companyId = $(this).data('id');
                var companyName = $(this).data('name');
                $('#lblCompanyNo').html(companyId);
                $('#lblCompanyName').html(companyName);
                $('#deleteModal').modal('show');
            });

            $(document).on('click', '#btnUpdate', function () {
                var companyId = $(this).data('id');
                var companyName = $(this).data('name');
                var address = $(this).data('address');
                var city = $(this).data('city');
                var poscode = $(this).data('poscode');
                var email = $(this).data('email');
                var phone = $(this).data('phone');

                $('#updateCompanyNo').val(companyId);
                $('#updateCompanyName').val(companyName);
                $('#updateCompanyAddress').val(address);
                $('#updateCompanyCity').val(city);
                $('#updateCompanyPoscode').val(poscode);
                $('#updateCompanyEmail').val(email);
                $('#updateCompanyPhone').val(phone);
                $('#editModal').modal('show');
            });

            $('#btnUpdateCompany').click(function () {
                $.ajax({
                    type: 'post',
                    url: '/Company/updateCompany',
                    data: {
                        CompanyNo: $('#updateCompanyNo').val(),
                        CompanyName: $('#updateCompanyName').val(),
                        CompanyAddress: $('#updateCompanyAddress').val(),
                        CompanyCity: $('#updateCompanyCity').val(),
                        CompanyPoscode: $('#updateCompanyPoscode').val(),
                        CompanyEmail: $('#updateCompanyEmail').val(),
                        CompanyPhone: $('#updateCompanyPhone').val(),
                    },
                    success: function (result) {
                        if (result.success) {
                            alert(result.message);
                            $('#editModal').modal('hide');
                            $('#dataTables1').DataTable().ajax.reload();
                        } else {
                            alert(result.message);
                        }
                    }
                });
            });

            $('#btnDeleteCompany').click(function () {
                $.ajax({
                    type: 'post',
                    url: '/Company/deleteCompany',
                    data: {
                        CompanyNo: $('#lblCompanyNo').html(),
                        CompanyName: $('#lblCompanyName').html(),
                    },
                    success: function (result) {
                        if (result.status == "ERROR") {
                            alert(result.data);
                        }
                        else {
                            alert(result.status);
                            $('#deleteModal').modal('hide');
                            $('#dataTables1').DataTable().ajax.reload();
                        }
                    }
                });
            });
        });
    </script>
}
